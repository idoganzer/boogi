---
title: The multiplayer folder
editable: false
---

<div align="center" style="background-color: #e5ecff">    <br/>    <div>DOC</div>    <h1>The multiplayer folder</h1>    <br/>  </div>

### Files Used:
ğŸ“„ src/script.js

ğŸ“„ src/multiplayer/authenticate.js

ğŸ“„ src/multiplayer/session.js

ğŸ“„ src/game.js


<br/>

The multiplayer folder consists of 5 interesting files
- `authenticate`
- `connect`
- `gameplay`
- `match`
- `session`

We are going to show how the all connect



<br/>

The following snippet shows how we create a new auth instance passing the user credentials and a connect instance

<div style="background: #e5ecff; padding: 10px 10px 10px 10px; border-bottom: 1px solid #c1c7d0; border-radius: 4px;">    ğŸ“„ src/script.js  </div>

```js
â¬œ 140    			$j('.error-pw').show();
â¬œ 141    			return;
â¬œ 142    		}
ğŸŸ© 143    		let auth = new Authenticate(reg, connect.client);
ğŸŸ© 144    		let session = await auth.register();
ğŸŸ© 145    		let sess = new SessionI(session);
ğŸŸ© 146    		sess.storeSession();
ğŸŸ© 147    		G.session = session;
ğŸŸ© 148    		G.client = connect.client;
ğŸŸ© 149    		G.multiplayer = true;
â¬œ 150    		$j('.setupFrame,.welcome').show();
â¬œ 151    		$j('.match-frame').show();
â¬œ 152    		$j('.loginregFrame,#gameSetup').hide();
```
<br/>

The constructor then sets the client and user details data members

<div style="background: #e5ecff; padding: 10px 10px 10px 10px; border-bottom: 1px solid #c1c7d0; border-radius: 4px;">    ğŸ“„ src/multiplayer/authenticate.js  </div>

```js
â¬œ 1      export default class Authenticate {
ğŸŸ© 2      	constructor(login, client) {
ğŸŸ© 3      		this.username = login.username || '';
ğŸŸ© 4      		this.email = login.email || '';
ğŸŸ© 5      		this.password = login.password || '';
ğŸŸ© 6      		this.client = client;
ğŸŸ© 7      	}
â¬œ 8      	async register() {
â¬œ 9      		var session = await this.client.authenticateEmail({
â¬œ 10     			email: this.email,
```
<br/>

We then use Nakama session and store it in the local storage

<div style="background: #e5ecff; padding: 10px 10px 10px 10px; border-bottom: 1px solid #c1c7d0; border-radius: 4px;">    ğŸ“„ src/multiplayer/session.js  </div>

```js
ğŸŸ© 1      import { Session } from '@heroiclabs/nakama-js/dist/nakama-js.esm';
ğŸŸ© 2      export default class SessionI {
ğŸŸ© 3      	constructor(session) {
ğŸŸ© 4      		this.session = session || '';
ğŸŸ© 5      	}
ğŸŸ© 6      	storeSession() {
ğŸŸ© 7      		if (typeof Storage !== 'undefined') {
ğŸŸ© 8      			localStorage.setItem('nakamaToken', this.session.token);
ğŸŸ© 9      			console.log('New Session stored.');
ğŸŸ© 10     		}
ğŸŸ© 11     	}
ğŸŸ© 12     	async getSessionFromStorage() {
ğŸŸ© 13     		if (typeof Storage !== 'undefined') {
ğŸŸ© 14     			return Promise.resolve(localStorage.getItem('nakamaToken'));
ğŸŸ© 15     		}
ğŸŸ© 16     	}
â¬œ 17     
â¬œ 18     	async restoreSession() {
â¬œ 19     		var session = null;
```
<br/>

In the game instance we create a new gameplay (only if multiplayer is on)

<div style="background: #e5ecff; padding: 10px 10px 10px 10px; border-bottom: 1px solid #c1c7d0; border-radius: 4px;">    ğŸ“„ src/game.js  </div>

```js
â¬œ 554    
â¬œ 555    		this.matchInit();
â¬œ 556    	}
ğŸŸ© 557    	async matchInit() {
ğŸŸ© 558    		if (this.multiplayer) {
ğŸŸ© 559    			if (Object.keys(this.match).length === 0) {
ğŸŸ© 560    				await this.connect.serverConnect(this.session);
ğŸŸ© 561    				let match = new MatchI(this.connect, this, this.session);
ğŸŸ© 562    				let gameplay = new Gameplay(this, match);
ğŸŸ© 563    				match.gameplay = gameplay;
ğŸŸ© 564    				this.gameplay = gameplay;
ğŸŸ© 565    				this.match = match;
ğŸŸ© 566    
ğŸŸ© 567    				// Only host
ğŸŸ© 568    				if (this.matchInitialized) {
ğŸŸ© 569    					let n = await this.match.matchCreate();
ğŸŸ© 570    
ğŸŸ© 571    					console.log('created match', n);
ğŸŸ© 572    					await match.matchMaker(n, this.configData);
ğŸŸ© 573    				}
ğŸŸ© 574    			}
ğŸŸ© 575    			// Non-host
ğŸŸ© 576    			if (this.matchid) {
ğŸŸ© 577    				let n = await this.match.matchJoin(this.matchid);
ğŸŸ© 578    				console.log('joined match', n);
ğŸŸ© 579    			}
ğŸŸ© 580    		}
ğŸŸ© 581    	}
â¬œ 582    	async matchJoin() {
â¬œ 583    		await this.matchInit();
â¬œ 584    		await this.match.matchMaker();
```
<br/>



<br/>

<br/><br/>

This file was generated by Swimm. [Click here to view it in the app](https://swimm.io/link?l=c3dpbW0lM0ElMkYlMkZyZXBvcyUyRm5xMjh5MjNzcTBpYnB4ZG4xSkpUJTJGZG9jcyUyRjFwTWpOeFlHdmloTjRua3ZHQURs). Timestamp: 2021-04-22T07:38:25.273Z
