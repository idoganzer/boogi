{"componentChunkName":"component---src-templates-docs-js","path":"/sb32VVJQ5Y3XvcbGWK9c","result":{"data":{"site":{"siteMetadata":{"title":"My BooGi App","docsLocation":"","docsLocationType":"","editable":true}},"mdx":{"fields":{"id":"46aa1bf8-1cd0-5b65-8eaf-fb08ae2b1393","title":"Domain Settings","slug":"/sb32VVJQ5Y3XvcbGWK9c"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Domain Settings\",\n  \"editable\": false\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"div\", {\n    align: \"center\",\n    style: {\n      \"backgroundColor\": \"#e5ecff\"\n    }\n  }, \"    \", mdx(\"br\", null), \"    \", mdx(\"div\", null, \"DOC\"), \"    \", mdx(\"h1\", null, \"Domain Settings\"), \"    \", mdx(\"br\", null), \"  \"), mdx(\"section\", null, mdx(\"h3\", {\n    parentName: \"section\"\n  }, \"Files Used:\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"\\uD83D\\uDCC4 cloud/firestore.rules\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"\\uD83D\\uDCC4 src/app/common/mixins/storeModulesWrapper.js\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"\\uD83D\\uDCC4 cloud/functions/index.js\"), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"In our Firstore we keep specific domain settings under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/domains\"), \" collection.\\nThe domain settings properties:\"), mdx(\"ol\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"isWorkspaceCreationProhibited\"), \" - if \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"true\"), \" then users in that email domain are not allowed to create new workspaces. This is useful when clients want to ensure their employees don't create additional workspaces, and make sure they are all within a single workspace assigned for their company.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"isInviteToWorkspaceOutsideDomainProhibited\"), \" - if \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"true\"), \" then users in a workspace that is connected to that domain (through \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"billing_account.domain\"), \") are not allowed to invite users in a different domain. e.g inviting emails which are not in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"@myCompany.com\"), \" domain will fail. \")), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"These are the Firestore rules for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/domains\"), \". The domains will be set by a Firestore admin and can be read only by users in the specific domain.\"), mdx(\"div\", {\n    style: {\n      \"background\": \"#e5ecff\",\n      \"padding\": \"10px 10px 10px 10px\",\n      \"borderBottom\": \"1px solid #c1c7d0\",\n      \"borderRadius\": \"4px\"\n    }\n  }, \"    \\uD83D\\uDCC4 cloud/firestore.rules  \"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rules\"\n  }), \"\\u2B1C 43     \\n\\uD83D\\uDFE9 44         match /{path=**}/domains/{domain} {\\n\\uD83D\\uDFE9 45           // Any writing is forbidden and can only be done by Swimm's team with direct access to the db.\\n\\uD83D\\uDFE9 46           allow read: if request.auth.token.email.split('@')[1] == domain;\\n\\uD83D\\uDFE9 47         }\\n\\u2B1C 48     \\n\")), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"We are fetching the domain settings on app load and store them in the FE store.\"), mdx(\"div\", {\n    style: {\n      \"background\": \"#e5ecff\",\n      \"padding\": \"10px 10px 10px 10px\",\n      \"borderBottom\": \"1px solid #c1c7d0\",\n      \"borderRadius\": \"4px\"\n    }\n  }, \"    \\uD83D\\uDCC4 src/app/common/mixins/storeModulesWrapper.js  \"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"\\u2B1C 112        async setDefaultAppData(repoId) {\\n\\u2B1C 113          if (this.$route.params.workspaceId) {\\n\\u2B1C 114            await this.fetchWorkspace({ workspaceId: this.$route.params.workspaceId });\\n\\u2B1C 115          }\\n\\u2B1C 116    \\n\\uD83D\\uDFE9 117          await this.fetchDomainSettings();\\n\\u2B1C 118    \\n\\u2B1C 119          const requestedRepoId = repoId || this.$route.params.repoId;\\n\\u2B1C 120          const loadResult = await this.loadLocalRepo(requestedRepoId);\\n\")), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"We are blocking workspace creation in the Firestore rules if \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isWorkspaceCreationProhibited\"), \" is active for the domain.\"), mdx(\"div\", {\n    style: {\n      \"background\": \"#e5ecff\",\n      \"padding\": \"10px 10px 10px 10px\",\n      \"borderBottom\": \"1px solid #c1c7d0\",\n      \"borderRadius\": \"4px\"\n    }\n  }, \"    \\uD83D\\uDCC4 cloud/firestore.rules  \"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rules\"\n  }), \"\\u2B1C 52     \\n\\uD83D\\uDFE9 53         match /workspaces/{workspace} {\\n\\uD83D\\uDFE9 54           allow create: if request.auth != null && !isWorkspaceCreationProhibitedForDomain();\\n\\u2B1C 55           allow update: if isUserWorkspaceAdmin(workspace) || (isUserInWorkspace(workspace) && hasOnlyUpdatedInvitesField());\\n\\u2B1C 56           allow list,read: if isUserInWorkspace(workspace) || isUserInvitedToResource(resource);\\n\")), mdx(\"br\", null), mdx(\"div\", {\n    style: {\n      \"background\": \"#e5ecff\",\n      \"padding\": \"10px 10px 10px 10px\",\n      \"borderBottom\": \"1px solid #c1c7d0\",\n      \"borderRadius\": \"4px\"\n    }\n  }, \"    \\uD83D\\uDCC4 cloud/firestore.rules  \"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rules\"\n  }), \"\\uD83D\\uDFE9 98           function isWorkspaceCreationProhibitedForDomain() {\\n\\uD83D\\uDFE9 99             let domain = request.auth.token.email.split('@')[1];\\n\\uD83D\\uDFE9 100            return exists(/databases/$(database)/documents/domains/$(domain)) && ('isWorkspaceCreationProhibited' in get(/databases/$(database)/documents/domains/$(domain)).data) && get(/databases/$(database)/documents/domains/$(domain)).data.isWorkspaceCreationProhibited;\\n\\uD83D\\uDFE9 101          }\\n\")), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"In the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"invite\"), \" cloud function we block out domain invites if \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isInviteToWorkspaceOutsideDomainProhibited\"), \" is active on the domain settings.\"), mdx(\"div\", {\n    style: {\n      \"background\": \"#e5ecff\",\n      \"padding\": \"10px 10px 10px 10px\",\n      \"borderBottom\": \"1px solid #c1c7d0\",\n      \"borderRadius\": \"4px\"\n    }\n  }, \"    \\uD83D\\uDCC4 cloud/functions/index.js  \"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"\\u2B1C 46             if (billingAccountRef.exists) {\\n\\u2B1C 47               usersLimit = billingAccountRef.data().users_limit;\\n\\u2B1C 48     \\n\\uD83D\\uDFE9 49               // fail invite if prohibited to invite an email with a different domain than the billing account\\n\\uD83D\\uDFE9 50               const domain = billingAccountRef.data().domain;\\n\\uD83D\\uDFE9 51               if (domain && !data.email.endsWith(`@${domain}`)) {\\n\\uD83D\\uDFE9 52                 const domainSettingsRef = await db.collection(`domains`).doc(domain).get();\\n\\uD83D\\uDFE9 53                 if (domainSettingsRef.exists) {\\n\\uD83D\\uDFE9 54                   if (!!domainSettingsRef.data().isInviteToWorkspaceOutsideDomainProhibited) {\\n\\uD83D\\uDFE9 55                     return { status: 'error', code: StatusCodes.FORBIDDEN };\\n\\uD83D\\uDFE9 56                   }\\n\\uD83D\\uDFE9 57                 }\\n\\uD83D\\uDFE9 58               }\\n\\u2B1C 59             }\\n\\u2B1C 60           }\\n\\u2B1C 61     \\n\")), mdx(\"br\", null), mdx(\"br\", null), mdx(\"br\", null), mdx(\"br\", null), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"This file was generated by Swimm. \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://swimm.io/link?l=c3dpbW0lM0ElMkYlMkZyZXBvcyUyRnZlZXp2eEN1enBQclJMTFhXRDJFJTJGZG9jcyUyRnNiMzJWVkpRNVkzWHZjYkdXSzlj\"\n  }), \"Click here to view it in the app\"), \". Timestamp: 2021-04-20T19:12:42.937Z\")));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#files-used","title":"Files Used:"}]},"timeToRead":1,"parent":{"__typename":"File","relativePath":"sb32VVJQ5Y3XvcbGWK9c.md","fields":null},"frontmatter":{"metaTitle":null,"showMetadata":null,"editable":false,"showPreviousNext":null,"showToc":null}},"gitBranch":{"name":"master"},"gitCommit":{"hash":"0cb17677e25377d6041a73fa8033496a1bb1ce03","date":"2021-04-21 03:46"}},"pageContext":{"id":"46aa1bf8-1cd0-5b65-8eaf-fb08ae2b1393"}},"staticQueryHashes":["12478684","12478684","2882937274","2882937274","353167761","353167761","3812332637","3812332637"]}